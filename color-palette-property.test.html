<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Test: Color Palette Consistency</title>
    
    <!-- Load CSS files -->
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/layout.css">
    
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-pass {
            color: #10b981;
            font-weight: bold;
        }
        .test-fail {
            color: #ef4444;
            font-weight: bold;
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            border-left: 3px solid #ccc;
        }
        .test-item.pass {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        .test-item.fail {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        h1 {
            color: #0f172a;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #f0fdfa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="test-results">
        <h1>ðŸ§ª Property-Based Test: Color Palette Consistency</h1>
        <p><strong>Feature:</strong> gozde-eksi-portfolio-website, Property 1: Color Palette Consistency</p>
        <p><strong>Validates:</strong> Requirements 1.1</p>
        <hr>
        <div id="test-output"></div>
        <div id="summary" class="summary"></div>
    </div>

    <!-- Test elements to verify -->
    <div style="display: none;">
        <nav class="test-nav"></nav>
        <button class="test-button"></button>
        <div class="test-card"></div>
        <section class="test-section"></section>
    </div>

    <script type="module">
        /**
         * Property-Based Test: Color Palette Consistency
         * 
         * For any key UI element, the computed CSS color values should match 
         * the defined color palette (turquoise: #0891b2, orange: #f97316, or their variants).
         */

        // Define the expected color palette from requirements
        const COLOR_PALETTE = {
            turquoise: '#0891b2',
            turquoiseLight: '#06b6d4',
            turquoiseDark: '#0e7490',
            orange: '#f97316',
            orangeLight: '#fb923c',
            orangeDark: '#ea580c',
            background: '#f0fdfa',
            backgroundAlt: '#fff7ed',
            text: '#0f172a',
            textLight: '#64748b',
            white: '#ffffff',
            success: '#10b981',
            error: '#ef4444',
            warning: '#f59e0b'
        };

        // Normalize color to hex format
        function normalizeColor(color) {
            if (!color || color === 'transparent' || color === 'inherit' || color === 'initial' || color === 'currentcolor') {
                return null;
            }
            
            // Handle rgb/rgba format
            const rgbMatch = color.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);
            if (rgbMatch) {
                const r = parseInt(rgbMatch[1]).toString(16).padStart(2, '0');
                const g = parseInt(rgbMatch[2]).toString(16).padStart(2, '0');
                const b = parseInt(rgbMatch[3]).toString(16).padStart(2, '0');
                return `#${r}${g}${b}`;
            }
            
            // Handle hex format
            if (color.startsWith('#')) {
                const hex = color.toLowerCase();
                // Convert 3-digit hex to 6-digit
                if (hex.length === 4) {
                    return `#${hex[1]}${hex[1]}${hex[2]}${hex[2]}${hex[3]}${hex[3]}`;
                }
                return hex;
            }
            
            return null;
        }

        // Check if a color is in the palette
        function isInPalette(color) {
            const normalized = normalizeColor(color);
            if (!normalized) return true; // Ignore transparent, inherit, etc.
            
            return Object.values(COLOR_PALETTE).some(paletteColor => 
                normalizeColor(paletteColor) === normalized
            );
        }

        // Test runner
        const testResults = [];
        let passCount = 0;
        let failCount = 0;

        function logTest(name, passed, details = '') {
            testResults.push({ name, passed, details });
            if (passed) {
                passCount++;
            } else {
                failCount++;
            }
        }

        // Test 1: CSS Variables match the palette
        function testCSSVariables() {
            const rootStyles = getComputedStyle(document.documentElement);
            
            const cssVariables = {
                '--color-turquoise': COLOR_PALETTE.turquoise,
                '--color-turquoise-light': COLOR_PALETTE.turquoiseLight,
                '--color-turquoise-dark': COLOR_PALETTE.turquoiseDark,
                '--color-orange': COLOR_PALETTE.orange,
                '--color-orange-light': COLOR_PALETTE.orangeLight,
                '--color-orange-dark': COLOR_PALETTE.orangeDark,
                '--color-background': COLOR_PALETTE.background,
                '--color-background-alt': COLOR_PALETTE.backgroundAlt,
                '--color-text': COLOR_PALETTE.text,
                '--color-text-light': COLOR_PALETTE.textLight,
                '--color-success': COLOR_PALETTE.success,
                '--color-error': COLOR_PALETTE.error,
                '--color-warning': COLOR_PALETTE.warning
            };
            
            let allMatch = true;
            let details = '';
            
            for (const [varName, expectedColor] of Object.entries(cssVariables)) {
                const actualColor = rootStyles.getPropertyValue(varName).trim();
                const normalizedActual = normalizeColor(actualColor);
                const normalizedExpected = normalizeColor(expectedColor);
                
                if (normalizedActual !== normalizedExpected) {
                    allMatch = false;
                    details += `${varName}: expected ${normalizedExpected}, got ${normalizedActual}; `;
                }
            }
            
            logTest('CSS Variables match defined palette', allMatch, details);
        }

        // Test 2: Body background uses palette color
        function testBodyBackground() {
            const body = document.body;
            const styles = getComputedStyle(body);
            const bgColor = styles.backgroundColor;
            
            const inPalette = isInPalette(bgColor);
            logTest('Body background color is in palette', inPalette, 
                `Background: ${bgColor} (${normalizeColor(bgColor)})`);
        }

        // Test 3: Text colors use palette
        function testTextColors() {
            const elements = ['h1', 'h2', 'p', 'a'];
            let allPass = true;
            let details = '';
            
            for (const selector of elements) {
                const element = document.querySelector(selector);
                if (element) {
                    const styles = getComputedStyle(element);
                    const color = styles.color;
                    
                    if (!isInPalette(color)) {
                        allPass = false;
                        details += `${selector}: ${color} (${normalizeColor(color)}); `;
                    }
                }
            }
            
            logTest('Text elements use palette colors', allPass, details);
        }

        // Test 4: Property-based test - random element selectors
        function testRandomElements() {
            const selectors = [
                'body', 'nav', 'button', 'section', 'main', 
                'h1', 'h2', 'p', 'a', 'div'
            ];
            
            let iterations = 100;
            let failures = [];
            
            for (let i = 0; i < iterations; i++) {
                // Pick random selector
                const selector = selectors[Math.floor(Math.random() * selectors.length)];
                const elements = document.querySelectorAll(selector);
                
                for (const element of elements) {
                    const styles = getComputedStyle(element);
                    
                    // Check color properties
                    const color = styles.color;
                    const backgroundColor = styles.backgroundColor;
                    const borderColor = styles.borderColor;
                    
                    if (color && color !== 'rgba(0, 0, 0, 0)' && !isInPalette(color)) {
                        failures.push(`${selector} color: ${color}`);
                    }
                    
                    if (backgroundColor && backgroundColor !== 'rgba(0, 0, 0, 0)' && !isInPalette(backgroundColor)) {
                        failures.push(`${selector} background: ${backgroundColor}`);
                    }
                    
                    if (borderColor && borderColor !== 'rgba(0, 0, 0, 0)' && !isInPalette(borderColor)) {
                        failures.push(`${selector} border: ${borderColor}`);
                    }
                }
            }
            
            const passed = failures.length === 0;
            logTest(`Property test: ${iterations} random element checks`, passed, 
                failures.length > 0 ? failures.slice(0, 5).join('; ') : '');
        }

        // Run all tests
        function runTests() {
            testCSSVariables();
            testBodyBackground();
            testTextColors();
            testRandomElements();
            
            // Display results
            const output = document.getElementById('test-output');
            testResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-item ${result.passed ? 'pass' : 'fail'}`;
                div.innerHTML = `
                    <span class="${result.passed ? 'test-pass' : 'test-fail'}">
                        ${result.passed ? 'âœ“ PASS' : 'âœ— FAIL'}
                    </span>
                    <strong>${result.name}</strong>
                    ${result.details ? `<br><small>${result.details}</small>` : ''}
                `;
                output.appendChild(div);
            });
            
            // Display summary
            const summary = document.getElementById('summary');
            const totalTests = passCount + failCount;
            const passRate = ((passCount / totalTests) * 100).toFixed(1);
            
            summary.innerHTML = `
                <h3>Test Summary</h3>
                <p><strong>Total Tests:</strong> ${totalTests}</p>
                <p><strong>Passed:</strong> <span class="test-pass">${passCount}</span></p>
                <p><strong>Failed:</strong> <span class="test-fail">${failCount}</span></p>
                <p><strong>Pass Rate:</strong> ${passRate}%</p>
                <p><strong>Status:</strong> ${failCount === 0 ? '<span class="test-pass">ALL TESTS PASSED âœ“</span>' : '<span class="test-fail">SOME TESTS FAILED âœ—</span>'}</p>
            `;
        }

        // Run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(runTests, 100);
        });
    </script>
</body>
</html>
