<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Announcement Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #0891b2;
            margin-top: 0;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-pass {
            background: #d1fae5;
            color: #065f46;
        }
        .test-fail {
            background: #fee2e2;
            color: #991b1b;
        }
        button {
            background: #0891b2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0e7490;
        }
        .form-preview {
            background: #f9fafb;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üß™ Announcement Form Test Suite</h1>
    
    <div class="test-section">
        <h2>Test 1: Form Structure Validation</h2>
        <p>Verifies that all required form fields exist in admin.html</p>
        <button onclick="testFormStructure()">Run Test</button>
        <div id="test1-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Form Validation Logic</h2>
        <p>Tests the form validation function with various inputs</p>
        <button onclick="testFormValidation()">Run Test</button>
        <div id="test2-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Create Announcement</h2>
        <p>Tests creating a new announcement through the form</p>
        <button onclick="testCreateAnnouncement()">Run Test</button>
        <div id="test3-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Edit Announcement (Pre-fill)</h2>
        <p>Tests editing an existing announcement and form pre-fill</p>
        <button onclick="testEditAnnouncement()">Run Test</button>
        <div id="test4-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 5: Update Announcement</h2>
        <p>Tests updating an existing announcement</p>
        <button onclick="testUpdateAnnouncement()">Run Test</button>
        <div id="test5-result"></div>
    </div>

    <script src="js/announcements.js"></script>
    <script>
        // Test utilities
        function showResult(elementId, passed, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="test-result ${passed ? 'test-pass' : 'test-fail'}">
                    ${passed ? '‚úÖ PASS' : '‚ùå FAIL'}: ${message}
                </div>
            `;
        }

        function showDetailedResult(elementId, results) {
            const element = document.getElementById(elementId);
            const html = results.map(r => `
                <div class="test-result ${r.passed ? 'test-pass' : 'test-fail'}">
                    ${r.passed ? '‚úÖ' : '‚ùå'} ${r.message}
                </div>
            `).join('');
            element.innerHTML = html;
        }

        // Test 1: Form Structure
        function testFormStructure() {
            const results = [];
            
            // Check if form fields exist in the HTML
            fetch('admin.html')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Check for form
                    const form = doc.getElementById('announcement-form');
                    results.push({
                        passed: !!form,
                        message: 'Form element exists'
                    });
                    
                    // Check for title field
                    const titleField = doc.getElementById('announcement-title');
                    results.push({
                        passed: !!titleField && titleField.getAttribute('maxlength') === '200',
                        message: 'Title field exists with maxlength=200'
                    });
                    
                    // Check for date field
                    const dateField = doc.getElementById('announcement-date');
                    results.push({
                        passed: !!dateField && dateField.getAttribute('type') === 'date',
                        message: 'Date field exists with type=date'
                    });
                    
                    // Check for time field
                    const timeField = doc.getElementById('announcement-time');
                    results.push({
                        passed: !!timeField && timeField.getAttribute('type') === 'time',
                        message: 'Time field exists with type=time'
                    });
                    
                    // Check for summary field
                    const summaryField = doc.getElementById('announcement-summary');
                    results.push({
                        passed: !!summaryField && summaryField.getAttribute('maxlength') === '150',
                        message: 'Summary field exists with maxlength=150'
                    });
                    
                    // Check for content field
                    const contentField = doc.getElementById('announcement-content');
                    results.push({
                        passed: !!contentField && contentField.tagName === 'TEXTAREA',
                        message: 'Content field exists as textarea'
                    });
                    
                    // Check for isActive checkbox
                    const activeField = doc.getElementById('announcement-active');
                    results.push({
                        passed: !!activeField && activeField.getAttribute('type') === 'checkbox',
                        message: 'Active checkbox exists'
                    });
                    
                    showDetailedResult('test1-result', results);
                })
                .catch(error => {
                    showResult('test1-result', false, 'Error loading admin.html: ' + error.message);
                });
        }

        // Test 2: Form Validation
        function testFormValidation() {
            const manager = new AnnouncementManager();
            const results = [];
            
            // Test valid data
            const validData = {
                title: 'Test Announcement',
                date: '2025-01-15',
                time: '14:30',
                summary: 'This is a test summary',
                content: 'This is the full content of the test announcement'
            };
            
            const validResult = manager.validateAnnouncement(validData);
            results.push({
                passed: validResult.isValid,
                message: 'Valid data passes validation'
            });
            
            // Test missing title
            const noTitle = { ...validData, title: '' };
            const noTitleResult = manager.validateAnnouncement(noTitle);
            results.push({
                passed: !noTitleResult.isValid && noTitleResult.errors.some(e => e.includes('Title')),
                message: 'Missing title fails validation'
            });
            
            // Test title too long
            const longTitle = { ...validData, title: 'a'.repeat(201) };
            const longTitleResult = manager.validateAnnouncement(longTitle);
            results.push({
                passed: !longTitleResult.isValid && longTitleResult.errors.some(e => e.includes('200')),
                message: 'Title exceeding 200 chars fails validation'
            });
            
            // Test missing date
            const noDate = { ...validData, date: '' };
            const noDateResult = manager.validateAnnouncement(noDate);
            results.push({
                passed: !noDateResult.isValid && noDateResult.errors.some(e => e.includes('Date')),
                message: 'Missing date fails validation'
            });
            
            // Test invalid date format
            const badDate = { ...validData, date: '15-01-2025' };
            const badDateResult = manager.validateAnnouncement(badDate);
            results.push({
                passed: !badDateResult.isValid && badDateResult.errors.some(e => e.includes('YYYY-MM-DD')),
                message: 'Invalid date format fails validation'
            });
            
            // Test missing time
            const noTime = { ...validData, time: '' };
            const noTimeResult = manager.validateAnnouncement(noTime);
            results.push({
                passed: !noTimeResult.isValid && noTimeResult.errors.some(e => e.includes('Time')),
                message: 'Missing time fails validation'
            });
            
            // Test summary too long
            const longSummary = { ...validData, summary: 'a'.repeat(151) };
            const longSummaryResult = manager.validateAnnouncement(longSummary);
            results.push({
                passed: !longSummaryResult.isValid && longSummaryResult.errors.some(e => e.includes('150')),
                message: 'Summary exceeding 150 chars fails validation'
            });
            
            // Test missing content
            const noContent = { ...validData, content: '' };
            const noContentResult = manager.validateAnnouncement(noContent);
            results.push({
                passed: !noContentResult.isValid && noContentResult.errors.some(e => e.includes('Content')),
                message: 'Missing content fails validation'
            });
            
            showDetailedResult('test2-result', results);
        }

        // Test 3: Create Announcement
        function testCreateAnnouncement() {
            // Clear localStorage first
            localStorage.removeItem('portfolio_announcements');
            
            const manager = new AnnouncementManager();
            const results = [];
            
            const newAnnouncement = {
                title: 'Test Create Announcement',
                date: '2025-01-20',
                time: '10:00',
                summary: 'This is a test summary for create',
                content: 'This is the full content for testing create functionality',
                isActive: true
            };
            
            const result = manager.create(newAnnouncement);
            
            results.push({
                passed: result.success,
                message: 'Create operation returns success'
            });
            
            results.push({
                passed: result.data && result.data.id,
                message: 'Created announcement has an ID'
            });
            
            results.push({
                passed: result.data && result.data.createdAt,
                message: 'Created announcement has createdAt timestamp'
            });
            
            results.push({
                passed: result.data && result.data.updatedAt,
                message: 'Created announcement has updatedAt timestamp'
            });
            
            // Verify it's in storage
            const allAnnouncements = manager.getAll();
            results.push({
                passed: allAnnouncements.length === 1,
                message: 'Announcement is saved to storage'
            });
            
            results.push({
                passed: allAnnouncements[0].title === newAnnouncement.title,
                message: 'Saved announcement has correct title'
            });
            
            showDetailedResult('test3-result', results);
        }

        // Test 4: Edit Announcement (Pre-fill)
        function testEditAnnouncement() {
            // Setup: Create an announcement first
            localStorage.removeItem('portfolio_announcements');
            const manager = new AnnouncementManager();
            
            const testAnnouncement = {
                title: 'Original Title',
                date: '2025-01-15',
                time: '14:30',
                summary: 'Original summary',
                content: 'Original content',
                isActive: true
            };
            
            const createResult = manager.create(testAnnouncement);
            const results = [];
            
            results.push({
                passed: createResult.success,
                message: 'Setup: Test announcement created'
            });
            
            if (!createResult.success) {
                showDetailedResult('test4-result', results);
                return;
            }
            
            const announcementId = createResult.data.id;
            
            // Test retrieval for editing
            const retrieved = manager.getById(announcementId);
            
            results.push({
                passed: !!retrieved,
                message: 'Announcement can be retrieved by ID'
            });
            
            results.push({
                passed: retrieved && retrieved.title === testAnnouncement.title,
                message: 'Retrieved announcement has correct title'
            });
            
            results.push({
                passed: retrieved && retrieved.date === testAnnouncement.date,
                message: 'Retrieved announcement has correct date'
            });
            
            results.push({
                passed: retrieved && retrieved.time === testAnnouncement.time,
                message: 'Retrieved announcement has correct time'
            });
            
            results.push({
                passed: retrieved && retrieved.summary === testAnnouncement.summary,
                message: 'Retrieved announcement has correct summary'
            });
            
            results.push({
                passed: retrieved && retrieved.content === testAnnouncement.content,
                message: 'Retrieved announcement has correct content'
            });
            
            results.push({
                passed: retrieved && retrieved.isActive === testAnnouncement.isActive,
                message: 'Retrieved announcement has correct active status'
            });
            
            showDetailedResult('test4-result', results);
        }

        // Test 5: Update Announcement
        function testUpdateAnnouncement() {
            // Setup: Create an announcement first
            localStorage.removeItem('portfolio_announcements');
            const manager = new AnnouncementManager();
            
            const originalAnnouncement = {
                title: 'Original Title',
                date: '2025-01-15',
                time: '14:30',
                summary: 'Original summary',
                content: 'Original content',
                isActive: true
            };
            
            const createResult = manager.create(originalAnnouncement);
            const results = [];
            
            results.push({
                passed: createResult.success,
                message: 'Setup: Test announcement created'
            });
            
            if (!createResult.success) {
                showDetailedResult('test5-result', results);
                return;
            }
            
            const announcementId = createResult.data.id;
            const originalCreatedAt = createResult.data.createdAt;
            
            // Update the announcement
            const updatedData = {
                title: 'Updated Title',
                date: '2025-01-20',
                time: '16:00',
                summary: 'Updated summary',
                content: 'Updated content',
                isActive: false
            };
            
            const updateResult = manager.update(announcementId, updatedData);
            
            results.push({
                passed: updateResult.success,
                message: 'Update operation returns success'
            });
            
            results.push({
                passed: updateResult.data && updateResult.data.id === announcementId,
                message: 'Updated announcement preserves ID'
            });
            
            results.push({
                passed: updateResult.data && updateResult.data.createdAt === originalCreatedAt,
                message: 'Updated announcement preserves createdAt'
            });
            
            results.push({
                passed: updateResult.data && updateResult.data.updatedAt > originalCreatedAt,
                message: 'Updated announcement has new updatedAt timestamp'
            });
            
            // Verify changes
            const retrieved = manager.getById(announcementId);
            
            results.push({
                passed: retrieved && retrieved.title === updatedData.title,
                message: 'Title was updated correctly'
            });
            
            results.push({
                passed: retrieved && retrieved.date === updatedData.date,
                message: 'Date was updated correctly'
            });
            
            results.push({
                passed: retrieved && retrieved.time === updatedData.time,
                message: 'Time was updated correctly'
            });
            
            results.push({
                passed: retrieved && retrieved.summary === updatedData.summary,
                message: 'Summary was updated correctly'
            });
            
            results.push({
                passed: retrieved && retrieved.content === updatedData.content,
                message: 'Content was updated correctly'
            });
            
            results.push({
                passed: retrieved && retrieved.isActive === updatedData.isActive,
                message: 'Active status was updated correctly'
            });
            
            showDetailedResult('test5-result', results);
        }

        // Auto-run all tests on load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Test page loaded. Click buttons to run tests.');
        });
    </script>
</body>
</html>
