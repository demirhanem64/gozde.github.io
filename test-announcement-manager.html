<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnnouncementManager Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>AnnouncementManager Test Suite</h1>
    
    <div class="test-section">
        <h2>Test Controls</h2>
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="clearStorage()">Clear Storage</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>

    <div id="results"></div>

    <script src="js/announcements.js"></script>
    <script>
        let testResults = [];

        function logResult(testName, success, message, data = null) {
            testResults.push({ testName, success, message, data });
            displayResults();
        }

        function displayResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = testResults.map(result => `
                <div class="test-section">
                    <h3>${result.testName}</h3>
                    <div class="test-result ${result.success ? 'success' : 'error'}">
                        ${result.message}
                    </div>
                    ${result.data ? `<pre>${JSON.stringify(result.data, null, 2)}</pre>` : ''}
                </div>
            `).join('');
        }

        function clearResults() {
            testResults = [];
            displayResults();
        }

        function clearStorage() {
            localStorage.clear();
            logResult('Storage Cleared', true, 'LocalStorage has been cleared');
        }

        function runAllTests() {
            clearResults();
            
            // Clear storage before tests
            localStorage.clear();
            
            // Test 1: Initialize AnnouncementManager
            try {
                const manager = new AnnouncementManager();
                logResult('Test 1: Initialize', true, 'AnnouncementManager initialized successfully', { announcements: manager.getAll() });
            } catch (error) {
                logResult('Test 1: Initialize', false, `Error: ${error.message}`);
                return;
            }

            // Test 2: Create valid announcement
            const manager = new AnnouncementManager();
            const validAnnouncement = {
                title: 'Test Duyuru',
                date: '2025-01-15',
                time: '14:30',
                summary: 'Bu bir test duyurusudur',
                content: 'Bu duyuru AnnouncementManager sınıfını test etmek için oluşturulmuştur.'
            };
            
            const createResult = manager.create(validAnnouncement);
            if (createResult.success) {
                logResult('Test 2: Create Valid Announcement', true, 'Announcement created successfully', createResult.data);
            } else {
                logResult('Test 2: Create Valid Announcement', false, `Failed: ${createResult.errors.join(', ')}`);
            }

            // Test 3: Validate data persistence
            const manager2 = new AnnouncementManager();
            const allAnnouncements = manager2.getAll();
            if (allAnnouncements.length === 1) {
                logResult('Test 3: Data Persistence', true, 'Data persisted correctly in LocalStorage', allAnnouncements);
            } else {
                logResult('Test 3: Data Persistence', false, `Expected 1 announcement, found ${allAnnouncements.length}`);
            }

            // Test 4: Get by ID
            if (allAnnouncements.length > 0) {
                const announcement = manager2.getById(allAnnouncements[0].id);
                if (announcement && announcement.title === 'Test Duyuru') {
                    logResult('Test 4: Get By ID', true, 'Retrieved announcement by ID', announcement);
                } else {
                    logResult('Test 4: Get By ID', false, 'Failed to retrieve announcement by ID');
                }
            }

            // Test 5: Update announcement
            if (allAnnouncements.length > 0) {
                const updateResult = manager2.update(allAnnouncements[0].id, {
                    title: 'Güncellenmiş Duyuru',
                    summary: 'Bu özet güncellendi'
                });
                if (updateResult.success) {
                    logResult('Test 5: Update Announcement', true, 'Announcement updated successfully', updateResult.data);
                } else {
                    logResult('Test 5: Update Announcement', false, `Failed: ${updateResult.errors.join(', ')}`);
                }
            }

            // Test 6: Create multiple announcements and test sorting
            manager2.create({
                title: 'Eski Duyuru',
                date: '2025-01-10',
                time: '10:00',
                summary: 'Eski bir duyuru',
                content: 'Bu daha eski bir duyurudur'
            });
            
            manager2.create({
                title: 'Yeni Duyuru',
                date: '2025-01-20',
                time: '16:00',
                summary: 'Yeni bir duyuru',
                content: 'Bu en yeni duyurudur'
            });

            const sorted = manager2.getSortedByDate();
            if (sorted.length === 3 && sorted[0].date === '2025-01-20') {
                logResult('Test 6: Sort By Date', true, 'Announcements sorted correctly (newest first)', sorted.map(a => ({ title: a.title, date: a.date, time: a.time })));
            } else {
                logResult('Test 6: Sort By Date', false, 'Sorting failed', sorted);
            }

            // Test 7: Validation - Missing title
            const invalidAnnouncement1 = {
                date: '2025-01-15',
                time: '14:30',
                summary: 'Test',
                content: 'Test content'
            };
            const result1 = manager2.create(invalidAnnouncement1);
            if (!result1.success && result1.errors.some(e => e.includes('Title'))) {
                logResult('Test 7: Validation - Missing Title', true, 'Correctly rejected announcement without title', result1.errors);
            } else {
                logResult('Test 7: Validation - Missing Title', false, 'Should have rejected announcement without title');
            }

            // Test 8: Validation - Invalid date format
            const invalidAnnouncement2 = {
                title: 'Test',
                date: '15-01-2025',
                time: '14:30',
                summary: 'Test',
                content: 'Test content'
            };
            const result2 = manager2.create(invalidAnnouncement2);
            if (!result2.success && result2.errors.some(e => e.includes('YYYY-MM-DD'))) {
                logResult('Test 8: Validation - Invalid Date', true, 'Correctly rejected invalid date format', result2.errors);
            } else {
                logResult('Test 8: Validation - Invalid Date', false, 'Should have rejected invalid date format');
            }

            // Test 9: Validation - Title too long
            const invalidAnnouncement3 = {
                title: 'A'.repeat(201),
                date: '2025-01-15',
                time: '14:30',
                summary: 'Test',
                content: 'Test content'
            };
            const result3 = manager2.create(invalidAnnouncement3);
            if (!result3.success && result3.errors.some(e => e.includes('200 characters'))) {
                logResult('Test 9: Validation - Title Too Long', true, 'Correctly rejected title exceeding 200 characters', result3.errors);
            } else {
                logResult('Test 9: Validation - Title Too Long', false, 'Should have rejected title exceeding 200 characters');
            }

            // Test 10: Delete announcement
            const allBeforeDelete = manager2.getAll();
            if (allBeforeDelete.length > 0) {
                const deleteResult = manager2.delete(allBeforeDelete[0].id);
                const allAfterDelete = manager2.getAll();
                if (deleteResult.success && allAfterDelete.length === allBeforeDelete.length - 1) {
                    logResult('Test 10: Delete Announcement', true, `Announcement deleted successfully. Count: ${allBeforeDelete.length} → ${allAfterDelete.length}`, deleteResult.data);
                } else {
                    logResult('Test 10: Delete Announcement', false, 'Delete operation failed');
                }
            }

            // Test 11: Unique ID generation
            const id1 = manager2.generateId();
            const id2 = manager2.generateId();
            if (id1 !== id2 && id1.startsWith('announcement_') && id2.startsWith('announcement_')) {
                logResult('Test 11: Unique ID Generation', true, 'IDs are unique and properly formatted', { id1, id2 });
            } else {
                logResult('Test 11: Unique ID Generation', false, 'ID generation failed', { id1, id2 });
            }
        }

        // Run tests on page load
        window.addEventListener('load', () => {
            console.log('AnnouncementManager test page loaded');
        });
    </script>
</body>
</html>
