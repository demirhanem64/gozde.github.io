<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Test: Unique Webhook URLs</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f0fdfa;
        }
        
        h1 {
            color: #0891b2;
            border-bottom: 3px solid #f97316;
            padding-bottom: 10px;
        }
        
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        
        .test-result.pass {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }
        
        .test-result.fail {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }
        
        .test-result.running {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }
        
        .test-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .test-details {
            font-size: 0.9em;
            margin-top: 5px;
            font-family: 'Courier New', monospace;
        }
        
        .summary {
            background: #0891b2;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        .summary.fail {
            background: #ef4444;
        }
        
        .property-info {
            background: #fff7ed;
            border-left: 4px solid #f97316;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .property-info h3 {
            margin-top: 0;
            color: #ea580c;
        }
        
        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>üß™ Property-Based Test: Unique Webhook URLs</h1>
    
    <div class="property-info">
        <h3>Property 25: Unique Webhook URLs</h3>
        <p><strong>Feature:</strong> gozde-eksi-portfolio-website</p>
        <p><strong>Validates:</strong> Requirements 10.4</p>
        <p><strong>Property Statement:</strong> <em>For any</em> two different surveys (survey1, survey2), their webhook URLs should be distinct (gozdeanket1 vs gozdeanket2).</p>
    </div>
    
    <div id="test-results"></div>
    
    <div id="summary" class="summary" style="display: none;">
        <h2 id="summary-text"></h2>
        <p id="summary-details"></p>
    </div>

    <script>
        // Simple property-based testing framework
        class PropertyTest {
            constructor() {
                this.results = [];
                this.numRuns = 100;
            }
            
            assert(testName, propertyFn, options = {}) {
                const runs = options.numRuns || this.numRuns;
                const results = [];
                
                try {
                    for (let i = 0; i < runs; i++) {
                        propertyFn(i);
                    }
                    this.results.push({ name: testName, passed: true, runs });
                    return true;
                } catch (error) {
                    this.results.push({ 
                        name: testName, 
                        passed: false, 
                        error: error.message,
                        runs 
                    });
                    return false;
                }
            }
            
            expect(actual) {
                return {
                    toBe(expected) {
                        if (actual !== expected) {
                            throw new Error(`Expected ${JSON.stringify(expected)}, got ${JSON.stringify(actual)}`);
                        }
                    },
                    not: {
                        toBe(expected) {
                            if (actual === expected) {
                                throw new Error(`Expected not to be ${JSON.stringify(expected)}`);
                            }
                        },
                        toContain(item) {
                            if (actual.includes(item)) {
                                throw new Error(`Expected not to contain ${JSON.stringify(item)}`);
                            }
                        }
                    },
                    toMatch(pattern) {
                        if (!pattern.test(actual)) {
                            throw new Error(`Expected ${JSON.stringify(actual)} to match pattern ${pattern}`);
                        }
                    },
                    toBeGreaterThan(expected) {
                        if (actual <= expected) {
                            throw new Error(`Expected ${actual} to be greater than ${expected}`);
                        }
                    }
                };
            }
        }
        
        // Test runner
        async function runTests() {
            const resultsDiv = document.getElementById('test-results');
            const pt = new PropertyTest();
            
            // Load surveys data
            let surveysData;
            try {
                const response = await fetch('../data/surveys.json');
                surveysData = await response.json();
            } catch (error) {
                resultsDiv.innerHTML += createTestResult(
                    'Load surveys.json',
                    false,
                    `Failed to load surveys data: ${error.message}`
                );
                showSummary(false, 0, 1);
                return;
            }
            
            const surveys = surveysData.surveys;
            
            // Test 1: All surveys have unique webhook URLs
            resultsDiv.innerHTML += createTestResult(
                'Test 1: All surveys have unique webhook URLs',
                null,
                'Running 100 iterations...'
            );
            
            const test1Passed = pt.assert(
                'All surveys have unique webhook URLs',
                (iteration) => {
                    // Generate two random indices
                    const index1 = Math.floor(Math.random() * surveys.length);
                    const index2 = Math.floor(Math.random() * surveys.length);
                    
                    // If indices are the same, skip
                    if (index1 === index2) return;
                    
                    const survey1 = surveys[index1];
                    const survey2 = surveys[index2];
                    
                    // Webhook URLs must be different for different surveys
                    pt.expect(survey1.webhookUrl).not.toBe(survey2.webhookUrl);
                }
            );
            
            updateTestResult(0, test1Passed, pt.results[0]);
            
            // Test 2: Webhook URLs follow pattern and are unique
            resultsDiv.innerHTML += createTestResult(
                'Test 2: Webhook URLs follow pattern and are unique',
                null,
                'Checking uniqueness and pattern...'
            );
            
            const test2Passed = pt.assert(
                'Webhook URLs follow pattern and are unique',
                () => {
                    // Collect all webhook URLs
                    const webhookUrls = surveys.map(survey => survey.webhookUrl);
                    
                    // No duplicate webhook URLs should exist
                    const uniqueUrls = new Set(webhookUrls);
                    pt.expect(uniqueUrls.size).toBe(webhookUrls.length);
                    
                    // Each webhook URL should follow the pattern
                    const expectedPattern = /^https:\/\/demirhanem\.com\.tr\/webhook\/gozdeanket\d+$/;
                    for (const survey of surveys) {
                        pt.expect(survey.webhookUrl).toMatch(expectedPattern);
                    }
                }
            );
            
            updateTestResult(1, test2Passed, pt.results[1]);
            
            // Test 3: Survey IDs and webhook URLs have consistent numbering
            resultsDiv.innerHTML += createTestResult(
                'Test 3: Survey IDs and webhook URLs have consistent numbering',
                null,
                'Running 100 iterations...'
            );
            
            const test3Passed = pt.assert(
                'Survey IDs and webhook URLs have consistent numbering',
                (iteration) => {
                    const randomIndex = Math.floor(Math.random() * surveys.length);
                    const survey = surveys[randomIndex];
                    
                    // Extract number from survey ID
                    const idMatch = survey.id.match(/gozdeanket(\d+)/);
                    if (!idMatch) {
                        throw new Error(`Survey ID ${survey.id} doesn't match expected pattern`);
                    }
                    const idNumber = idMatch[1];
                    
                    // Extract number from webhook URL
                    const urlMatch = survey.webhookUrl.match(/gozdeanket(\d+)$/);
                    if (!urlMatch) {
                        throw new Error(`Webhook URL ${survey.webhookUrl} doesn't match expected pattern`);
                    }
                    const urlNumber = urlMatch[1];
                    
                    // Numbers should match
                    pt.expect(idNumber).toBe(urlNumber);
                }
            );
            
            updateTestResult(2, test3Passed, pt.results[2]);
            
            // Test 4: Adding new surveys maintains uniqueness
            resultsDiv.innerHTML += createTestResult(
                'Test 4: Adding new surveys maintains uniqueness',
                null,
                'Running 100 iterations...'
            );
            
            const test4Passed = pt.assert(
                'Adding new surveys maintains uniqueness',
                (iteration) => {
                    const newSurveyNumber = surveys.length + 1 + iteration;
                    const newWebhookUrl = `https://demirhanem.com.tr/webhook/gozdeanket${newSurveyNumber}`;
                    
                    // New webhook URL should not conflict with existing ones
                    const existingUrls = surveys.map(s => s.webhookUrl);
                    pt.expect(existingUrls).not.toContain(newWebhookUrl);
                }
            );
            
            updateTestResult(3, test4Passed, pt.results[3]);
            
            // Test 5: Verify actual survey data
            resultsDiv.innerHTML += createTestResult(
                'Test 5: Verify actual survey data has unique URLs',
                null,
                'Checking actual data...'
            );
            
            const test5Passed = pt.assert(
                'Verify actual survey data has unique URLs',
                () => {
                    const urls = surveys.map(s => s.webhookUrl);
                    const uniqueUrls = new Set(urls);
                    
                    pt.expect(uniqueUrls.size).toBe(surveys.length);
                    pt.expect(surveys.length).toBeGreaterThan(0);
                    
                    // Verify specific surveys
                    const expectedUrls = [
                        'https://demirhanem.com.tr/webhook/gozdeanket1',
                        'https://demirhanem.com.tr/webhook/gozdeanket2',
                        'https://demirhanem.com.tr/webhook/gozdeanket3'
                    ];
                    
                    for (let i = 0; i < Math.min(surveys.length, expectedUrls.length); i++) {
                        pt.expect(surveys[i].webhookUrl).toBe(expectedUrls[i]);
                    }
                }
            );
            
            updateTestResult(4, test5Passed, pt.results[4]);
            
            // Show summary
            const totalTests = pt.results.length;
            const passedTests = pt.results.filter(r => r.passed).length;
            showSummary(passedTests === totalTests, passedTests, totalTests);
        }
        
        function createTestResult(name, passed, details) {
            const status = passed === null ? 'running' : (passed ? 'pass' : 'fail');
            const icon = passed === null ? '‚è≥' : (passed ? '‚úÖ' : '‚ùå');
            
            return `
                <div class="test-section">
                    <div class="test-result ${status}">
                        <div class="test-name">${icon} ${name}</div>
                        <div class="test-details">${details}</div>
                    </div>
                </div>
            `;
        }
        
        function updateTestResult(index, passed, result) {
            const sections = document.querySelectorAll('.test-section');
            const section = sections[index];
            const testResult = section.querySelector('.test-result');
            
            testResult.className = `test-result ${passed ? 'pass' : 'fail'}`;
            
            const icon = passed ? '‚úÖ' : '‚ùå';
            const testName = testResult.querySelector('.test-name');
            testName.innerHTML = testName.innerHTML.replace(/^[‚è≥‚úÖ‚ùå]/, icon);
            
            const details = passed 
                ? `PASSED - ${result.runs} iterations completed successfully`
                : `FAILED - ${result.error}`;
            
            testResult.querySelector('.test-details').textContent = details;
        }
        
        function showSummary(allPassed, passed, total) {
            const summaryDiv = document.getElementById('summary');
            const summaryText = document.getElementById('summary-text');
            const summaryDetails = document.getElementById('summary-details');
            
            summaryDiv.style.display = 'block';
            summaryDiv.className = allPassed ? 'summary' : 'summary fail';
            
            if (allPassed) {
                summaryText.textContent = 'üéâ All Tests Passed!';
                summaryDetails.textContent = `${passed} out of ${total} property tests passed`;
            } else {
                summaryText.textContent = '‚ùå Some Tests Failed';
                summaryDetails.textContent = `${passed} out of ${total} property tests passed`;
            }
        }
        
        // Run tests when page loads
        window.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
