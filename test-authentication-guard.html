<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Authentication Guard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #0891b2;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-pass {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        .test-fail {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        .test-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            background: #0891b2;
            color: white;
        }
        button:hover {
            background: #0e7490;
        }
        .controls {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-section">
        <div class="test-title">üîê Authentication Guard Test</div>
        <div class="test-info">
            <strong>Test Purpose:</strong> Verify that the authentication guard properly checks authentication status on page load and controls access to the admin panel.
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">Test Controls</div>
        <div class="controls">
            <button onclick="testUnauthenticatedState()">Test 1: Unauthenticated State</button>
            <button onclick="testAuthenticatedState()">Test 2: Authenticated State</button>
            <button onclick="testSessionExpiry()">Test 3: Session Expiry</button>
            <button onclick="clearAuth()">Clear Auth</button>
            <button onclick="runAllTests()">Run All Tests</button>
        </div>
    </div>

    <div id="results" class="test-section">
        <div class="test-title">Test Results</div>
        <div id="test-output"></div>
    </div>

    <script src="js/admin-auth.js"></script>
    <script>
        const adminAuth = new AdminAuth();
        const output = document.getElementById('test-output');

        function addResult(message, isPass) {
            const div = document.createElement('div');
            div.className = `test-result ${isPass ? 'test-pass' : 'test-fail'}`;
            div.innerHTML = `${isPass ? '‚úÖ' : '‚ùå'} ${message}`;
            output.appendChild(div);
        }

        function addInfo(message) {
            const div = document.createElement('div');
            div.className = 'test-result test-info';
            div.innerHTML = `‚ÑπÔ∏è ${message}`;
            output.appendChild(div);
        }

        function clearResults() {
            output.innerHTML = '';
        }

        function clearAuth() {
            localStorage.removeItem('admin_auth');
            localStorage.removeItem('admin_session');
            addInfo('Authentication cleared from localStorage');
        }

        // Test 1: Verify unauthenticated state
        function testUnauthenticatedState() {
            clearResults();
            addInfo('Running Test 1: Unauthenticated State');
            
            // Clear any existing auth
            clearAuth();
            
            // Check if isAuthenticated returns false
            const isAuth = adminAuth.isAuthenticated();
            addResult(
                `isAuthenticated() returns false when not logged in: ${!isAuth}`,
                !isAuth
            );
            
            // Verify localStorage doesn't have auth token
            const authToken = localStorage.getItem('admin_auth');
            addResult(
                `localStorage does not contain auth token: ${authToken === null}`,
                authToken === null
            );
            
            addInfo('Test 1 Complete: In this state, admin panel should show login form');
        }

        // Test 2: Verify authenticated state
        function testAuthenticatedState() {
            clearResults();
            addInfo('Running Test 2: Authenticated State');
            
            // Login with correct password
            const loginResult = adminAuth.login('admin123');
            addResult(
                `Login with correct password succeeds: ${loginResult.success}`,
                loginResult.success
            );
            
            // Check if isAuthenticated returns true
            const isAuth = adminAuth.isAuthenticated();
            addResult(
                `isAuthenticated() returns true after login: ${isAuth}`,
                isAuth
            );
            
            // Verify localStorage has auth token
            const authToken = localStorage.getItem('admin_auth');
            addResult(
                `localStorage contains auth token: ${authToken === 'authenticated'}`,
                authToken === 'authenticated'
            );
            
            // Verify session data exists
            const sessionData = localStorage.getItem('admin_session');
            const hasSession = sessionData !== null;
            addResult(
                `Session data exists in localStorage: ${hasSession}`,
                hasSession
            );
            
            if (hasSession) {
                const session = JSON.parse(sessionData);
                const hasExpiry = session.expiresAt > Date.now();
                addResult(
                    `Session has valid expiry time: ${hasExpiry}`,
                    hasExpiry
                );
            }
            
            addInfo('Test 2 Complete: In this state, admin panel should be visible');
        }

        // Test 3: Verify session expiry handling
        function testSessionExpiry() {
            clearResults();
            addInfo('Running Test 3: Session Expiry');
            
            // Create an expired session
            const expiredSession = {
                authenticated: true,
                loginTime: Date.now() - 3 * 60 * 60 * 1000, // 3 hours ago
                expiresAt: Date.now() - 1000 // Expired 1 second ago
            };
            
            localStorage.setItem('admin_auth', 'authenticated');
            localStorage.setItem('admin_session', JSON.stringify(expiredSession));
            
            addInfo('Created expired session in localStorage');
            
            // Check if isAuthenticated detects expiry
            const isAuth = adminAuth.isAuthenticated();
            addResult(
                `isAuthenticated() returns false for expired session: ${!isAuth}`,
                !isAuth
            );
            
            // Verify auth was cleared
            const authToken = localStorage.getItem('admin_auth');
            addResult(
                `Expired session was cleared from localStorage: ${authToken === null}`,
                authToken === null
            );
            
            addInfo('Test 3 Complete: Expired sessions should trigger logout');
        }

        // Run all tests sequentially
        async function runAllTests() {
            clearResults();
            addInfo('Running All Tests...');
            
            await new Promise(resolve => setTimeout(resolve, 500));
            testUnauthenticatedState();
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            testAuthenticatedState();
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            testSessionExpiry();
            
            addInfo('All tests completed!');
        }

        // Initial info
        addInfo('Click a test button to verify authentication guard functionality');
        addInfo('Open admin.html in another tab to see the guard in action');
    </script>
</body>
</html>
