<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survey Form Test</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        body {
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: 4px;
        }
        .test-pass {
            background-color: #d4edda;
            color: #155724;
        }
        .test-fail {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Survey Form Implementation Test</h1>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>Rendered Form</h2>
        <div id="test-container"></div>
    </div>

    <script type="module">
        import { SurveyForm } from './js/forms.js';

        const testResults = document.getElementById('test-results');
        
        function addTestResult(testName, passed, message = '') {
            const div = document.createElement('div');
            div.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            div.textContent = `${passed ? '✓' : '✗'} ${testName}${message ? ': ' + message : ''}`;
            testResults.appendChild(div);
        }

        // Mock survey configuration
        const mockSurveyConfig = {
            id: "gozdeanket1",
            title: "Test Anketi",
            description: "Test açıklaması",
            webhookUrl: "https://demirhanem.com.tr/webhook/gozdeanket1",
            fields: [
                {
                    name: "firstName",
                    type: "text",
                    label: "Ad",
                    required: true,
                    placeholder: "Adınızı giriniz",
                    validation: { minLength: 2 }
                },
                {
                    name: "lastName",
                    type: "text",
                    label: "Soyad",
                    required: true,
                    placeholder: "Soyadınızı giriniz",
                    validation: { minLength: 2 }
                },
                {
                    name: "departmentClass",
                    type: "text",
                    label: "Bölüm - Sınıf",
                    required: true,
                    placeholder: "Örn: İlk ve Acil Yardım - 2. Sınıf"
                },
                {
                    name: "email",
                    type: "email",
                    label: "E-posta",
                    required: true,
                    placeholder: "ornek@email.com",
                    validation: { pattern: "email" }
                }
            ]
        };

        // Run tests
        try {
            // Test 1: SurveyForm class instantiation
            const surveyForm = new SurveyForm(mockSurveyConfig);
            addTestResult('SurveyForm class instantiation', surveyForm !== undefined);

            // Test 2: Render method
            surveyForm.render('test-container');
            const form = document.querySelector('#test-container form');
            addTestResult('Form rendered', form !== null);

            // Test 3: Check for required fields (Ad, Soyad, Bölüm-Sınıf, e-mail)
            const firstNameInput = form.querySelector('#firstName');
            addTestResult('Ad field exists', firstNameInput !== null);
            
            const lastNameInput = form.querySelector('#lastName');
            addTestResult('Soyad field exists', lastNameInput !== null);
            
            const deptInput = form.querySelector('#departmentClass');
            addTestResult('Bölüm-Sınıf field exists', deptInput !== null);
            
            const emailInput = form.querySelector('#email');
            addTestResult('E-mail field exists', emailInput !== null);

            // Test 4: KVKK sensitive fields should NOT exist
            const telefonInput = form.querySelector('#telefon');
            addTestResult('Telefon field does NOT exist (KVKK compliance)', telefonInput === null);
            
            const tcknInput = form.querySelector('#TCKN');
            addTestResult('TCKN field does NOT exist (KVKK compliance)', tcknInput === null);

            // Test 5: Check for labels
            const firstNameLabel = form.querySelector('label[for="firstName"]');
            addTestResult('Ad field has label', firstNameLabel !== null && firstNameLabel.textContent.includes('Ad'));
            
            const lastNameLabel = form.querySelector('label[for="lastName"]');
            addTestResult('Soyad field has label', lastNameLabel !== null && lastNameLabel.textContent.includes('Soyad'));
            
            const deptLabel = form.querySelector('label[for="departmentClass"]');
            addTestResult('Bölüm-Sınıf field has label', deptLabel !== null && deptLabel.textContent.includes('Bölüm'));
            
            const emailLabel = form.querySelector('label[for="email"]');
            addTestResult('E-mail field has label', emailLabel !== null && emailLabel.textContent.includes('E-posta'));

            // Test 6: Check for placeholders
            addTestResult('Ad field has placeholder', firstNameInput.placeholder === 'Adınızı giriniz');
            addTestResult('Soyad field has placeholder', lastNameInput.placeholder === 'Soyadınızı giriniz');
            addTestResult('Bölüm-Sınıf field has placeholder', deptInput.placeholder.includes('İlk ve Acil Yardım'));
            addTestResult('E-mail field has placeholder', emailInput.placeholder === 'ornek@email.com');

            // Test 7: KVKK consent checkbox
            const kvkkCheckbox = form.querySelector('#kvkkConsent');
            addTestResult('KVKK consent checkbox exists', kvkkCheckbox !== null);
            addTestResult('KVKK consent is required', kvkkCheckbox.required === true);

            // Test 8: Submit button
            const submitButton = form.querySelector('button[type="submit"]');
            addTestResult('Submit button exists', submitButton !== null);
            addTestResult('Submit button initially disabled', submitButton.disabled === true);

            // Test 9: Verify no sensitive field names in HTML
            const formHTML = form.innerHTML.toLowerCase();
            addTestResult('Form HTML does not contain "telefon"', !formHTML.includes('telefon'));
            addTestResult('Form HTML does not contain "tckn"', !formHTML.includes('tckn'));

            console.log('All tests completed!');
        } catch (error) {
            addTestResult('Test execution', false, error.message);
            console.error('Test error:', error);
        }
    </script>
</body>
</html>
