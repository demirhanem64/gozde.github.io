<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Reset Test</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        body {
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 2px solid var(--color-primary);
            border-radius: 8px;
        }
        .test-result {
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 4px;
            font-weight: bold;
        }
        .test-pass {
            background-color: #d1fae5;
            color: #065f46;
        }
        .test-fail {
            background-color: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <h1>Form Reset Functionality Test</h1>
    <p>This test verifies that the form reset method properly clears all fields and returns the form to its initial state.</p>

    <div class="test-section">
        <h2>Test: Form Reset After Submission</h2>
        <div id="test-form-container"></div>
        <button id="run-test" class="btn btn-primary" style="margin-top: 1rem;">Run Test</button>
        <div id="test-results"></div>
    </div>

    <script type="module">
        import { SurveyForm } from './js/forms.js';

        // Mock survey configuration
        const mockSurvey = {
            id: "gozdeanket1",
            title: "Test Survey",
            description: "Test survey for reset functionality",
            webhookUrl: "https://demirhanem.com.tr/webhook/gozdeanket1",
            fields: [
                {
                    name: "firstName",
                    type: "text",
                    label: "Ad",
                    required: true,
                    validation: { minLength: 2 }
                },
                {
                    name: "lastName",
                    type: "text",
                    label: "Soyad",
                    required: true,
                    validation: { minLength: 2 }
                },
                {
                    name: "departmentClass",
                    type: "text",
                    label: "Bölüm - Sınıf",
                    required: true,
                    placeholder: "Örn: İlk ve Acil Yardım - 2. Sınıf"
                },
                {
                    name: "email",
                    type: "email",
                    label: "E-posta",
                    required: true
                }
            ]
        };

        document.getElementById('run-test').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>Running test...</p>';

            try {
                // Create form
                const surveyForm = new SurveyForm(mockSurvey);
                surveyForm.render('test-form-container');

                // Wait for form to render
                await new Promise(resolve => setTimeout(resolve, 100));

                // Fill in form fields
                document.getElementById('firstName').value = 'Ahmet';
                document.getElementById('lastName').value = 'Yılmaz';
                document.getElementById('departmentClass').value = 'İlk ve Acil Yardım - 2. Sınıf';
                document.getElementById('email').value = 'ahmet@example.com';
                document.getElementById('kvkkConsent').checked = true;

                // Verify fields are filled
                const beforeReset = {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    departmentClass: document.getElementById('departmentClass').value,
                    email: document.getElementById('email').value,
                    kvkkConsent: document.getElementById('kvkkConsent').checked,
                    submitDisabled: document.querySelector('button[type="submit"]').disabled
                };

                console.log('Before reset:', beforeReset);

                // Call reset method
                surveyForm.reset();

                // Wait for reset to complete
                await new Promise(resolve => setTimeout(resolve, 100));

                // Check if fields are cleared
                const afterReset = {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    departmentClass: document.getElementById('departmentClass').value,
                    email: document.getElementById('email').value,
                    kvkkConsent: document.getElementById('kvkkConsent').checked,
                    submitDisabled: document.querySelector('button[type="submit"]').disabled
                };

                console.log('After reset:', afterReset);

                // Verify reset worked
                const tests = [
                    { name: 'First name cleared', pass: afterReset.firstName === '' },
                    { name: 'Last name cleared', pass: afterReset.lastName === '' },
                    { name: 'Department cleared', pass: afterReset.departmentClass === '' },
                    { name: 'Email cleared', pass: afterReset.email === '' },
                    { name: 'KVKK consent unchecked', pass: afterReset.kvkkConsent === false },
                    { name: 'Submit button disabled', pass: afterReset.submitDisabled === true },
                    { name: 'Error messages cleared', pass: document.querySelectorAll('.form-error').length === 0 || Array.from(document.querySelectorAll('.form-error')).every(el => el.textContent === '') },
                    { name: 'Error classes removed', pass: document.querySelectorAll('.form-input.error').length === 0 }
                ];

                const allPassed = tests.every(test => test.pass);

                let resultsHTML = '<h3>Test Results:</h3><ul>';
                tests.forEach(test => {
                    resultsHTML += `<li>${test.pass ? '✅' : '❌'} ${test.name}</li>`;
                });
                resultsHTML += '</ul>';

                resultsHTML += `<div class="test-result ${allPassed ? 'test-pass' : 'test-fail'}">
                    ${allPassed ? '✅ ALL TESTS PASSED' : '❌ SOME TESTS FAILED'}
                </div>`;

                resultsDiv.innerHTML = resultsHTML;

            } catch (error) {
                console.error('Test error:', error);
                resultsDiv.innerHTML = `<div class="test-result test-fail">❌ Test failed with error: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html>
