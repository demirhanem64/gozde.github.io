<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Announcement Delete Functionality</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f0fdfa;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-title {
            font-size: 24px;
            font-weight: bold;
            color: #0891b2;
            margin-bottom: 15px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: 500;
        }
        .test-pass {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        .test-fail {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        .test-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }
        button {
            background: linear-gradient(135deg, #0891b2, #06b6d4);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(8, 145, 178, 0.3);
        }
        .announcement-list {
            margin: 15px 0;
            padding: 10px;
            background: #f8fafc;
            border-radius: 5px;
        }
        .announcement-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .delete-btn {
            background: #ef4444;
            padding: 5px 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-section">
        <h1 class="test-title">üß™ Announcement Delete Functionality Test</h1>
        <p>This test verifies Requirements 7.6 and 7.7:</p>
        <ul>
            <li><strong>7.6:</strong> WHEN admin clicks delete button THEN system SHALL show confirmation dialog</li>
            <li><strong>7.7:</strong> WHEN deletion is confirmed THEN system SHALL remove announcement from list</li>
        </ul>
    </div>

    <div class="test-section">
        <h2 class="test-title">Test Setup</h2>
        <button onclick="setupTestData()">Setup Test Data</button>
        <button onclick="clearTestData()">Clear Test Data</button>
        <div id="setup-result"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">Current Announcements</h2>
        <div id="announcement-list" class="announcement-list"></div>
        <button onclick="refreshList()">Refresh List</button>
    </div>

    <div class="test-section">
        <h2 class="test-title">Test Results</h2>
        <button onclick="runTests()">Run All Tests</button>
        <div id="test-results"></div>
    </div>

    <script src="js/announcements.js"></script>
    <script>
        let announcementManager;

        // Initialize
        function init() {
            announcementManager = new AnnouncementManager();
            refreshList();
        }

        // Setup test data
        function setupTestData() {
            const setupResult = document.getElementById('setup-result');
            announcementManager = new AnnouncementManager();
            
            // Clear existing data
            announcementManager.announcements = [];
            announcementManager.saveAnnouncements();
            
            // Create test announcements
            const testAnnouncements = [
                {
                    title: "Test Announcement 1",
                    date: "2025-01-15",
                    time: "10:00",
                    summary: "This is test announcement 1",
                    content: "Full content for test announcement 1",
                    isActive: true
                },
                {
                    title: "Test Announcement 2",
                    date: "2025-01-14",
                    time: "14:30",
                    summary: "This is test announcement 2",
                    content: "Full content for test announcement 2",
                    isActive: true
                },
                {
                    title: "Test Announcement 3",
                    date: "2025-01-13",
                    time: "09:15",
                    summary: "This is test announcement 3",
                    content: "Full content for test announcement 3",
                    isActive: true
                }
            ];

            let successCount = 0;
            testAnnouncements.forEach(data => {
                const result = announcementManager.create(data);
                if (result.success) successCount++;
            });

            setupResult.innerHTML = `<div class="test-result test-pass">‚úÖ Created ${successCount} test announcements</div>`;
            refreshList();
        }

        // Clear test data
        function clearTestData() {
            announcementManager = new AnnouncementManager();
            announcementManager.announcements = [];
            announcementManager.saveAnnouncements();
            
            const setupResult = document.getElementById('setup-result');
            setupResult.innerHTML = `<div class="test-result test-info">üóëÔ∏è All test data cleared</div>`;
            refreshList();
        }

        // Refresh announcement list
        function refreshList() {
            announcementManager = new AnnouncementManager();
            const announcements = announcementManager.getAll();
            const listContainer = document.getElementById('announcement-list');
            
            if (announcements.length === 0) {
                listContainer.innerHTML = '<p style="color: #64748b;">No announcements found. Click "Setup Test Data" to create test announcements.</p>';
                return;
            }

            listContainer.innerHTML = announcements.map(ann => `
                <div class="announcement-item">
                    <div>
                        <strong>${ann.title}</strong><br>
                        <small>${ann.date} ${ann.time}</small>
                    </div>
                    <button class="delete-btn" onclick="testDelete('${ann.id}', '${ann.title}')">Delete</button>
                </div>
            `).join('');
        }

        // Test delete with confirmation
        function testDelete(id, title) {
            if (confirm(`Delete "${title}"?\n\nThis tests Requirement 7.6: Confirmation dialog`)) {
                const result = announcementManager.delete(id);
                
                if (result.success) {
                    alert(`‚úÖ Successfully deleted "${title}"\n\nThis validates Requirement 7.7: Remove from list`);
                    refreshList();
                } else {
                    alert(`‚ùå Failed to delete: ${result.errors.join(', ')}`);
                }
            } else {
                alert('Deletion cancelled by user');
            }
        }

        // Run automated tests
        function runTests() {
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = '<div class="test-result test-info">Running tests...</div>';
            
            const results = [];
            
            // Test 1: Delete method exists
            results.push({
                name: 'Test 1: Delete method exists',
                pass: typeof announcementManager.delete === 'function',
                message: 'AnnouncementManager has delete method'
            });

            // Test 2: Delete non-existent announcement
            const deleteNonExistent = announcementManager.delete('non-existent-id');
            results.push({
                name: 'Test 2: Delete non-existent announcement',
                pass: !deleteNonExistent.success && deleteNonExistent.errors.includes('Announcement not found'),
                message: 'Returns error for non-existent announcement'
            });

            // Test 3: Delete existing announcement
            const testData = {
                title: "Temporary Test Announcement",
                date: "2025-01-20",
                time: "12:00",
                summary: "This will be deleted",
                content: "Test content",
                isActive: true
            };
            
            const createResult = announcementManager.create(testData);
            if (createResult.success) {
                const initialCount = announcementManager.getAll().length;
                const deleteResult = announcementManager.delete(createResult.data.id);
                const finalCount = announcementManager.getAll().length;
                
                results.push({
                    name: 'Test 3: Delete existing announcement',
                    pass: deleteResult.success && finalCount === initialCount - 1,
                    message: `Successfully deleted announcement. Count: ${initialCount} ‚Üí ${finalCount}`
                });

                // Test 4: Verify announcement is removed
                const getDeleted = announcementManager.getById(createResult.data.id);
                results.push({
                    name: 'Test 4: Verify announcement is removed',
                    pass: getDeleted === null,
                    message: 'Deleted announcement cannot be retrieved'
                });
            } else {
                results.push({
                    name: 'Test 3: Delete existing announcement',
                    pass: false,
                    message: 'Failed to create test announcement'
                });
            }

            // Test 5: Delete updates localStorage
            const beforeDelete = localStorage.getItem('portfolio_announcements');
            const testData2 = {
                title: "Another Test",
                date: "2025-01-21",
                time: "15:00",
                summary: "Test",
                content: "Test",
                isActive: true
            };
            const createResult2 = announcementManager.create(testData2);
            if (createResult2.success) {
                announcementManager.delete(createResult2.data.id);
                const afterDelete = localStorage.getItem('portfolio_announcements');
                
                results.push({
                    name: 'Test 5: Delete updates localStorage',
                    pass: beforeDelete !== afterDelete,
                    message: 'localStorage is updated after deletion'
                });
            }

            // Display results
            const passCount = results.filter(r => r.pass).length;
            const totalCount = results.length;
            
            let html = `<div class="test-result ${passCount === totalCount ? 'test-pass' : 'test-fail'}">
                <strong>Test Summary: ${passCount}/${totalCount} tests passed</strong>
            </div>`;
            
            results.forEach(result => {
                html += `<div class="test-result ${result.pass ? 'test-pass' : 'test-fail'}">
                    ${result.pass ? '‚úÖ' : '‚ùå'} <strong>${result.name}</strong><br>
                    ${result.message}
                </div>`;
            });
            
            resultsContainer.innerHTML = html;
            refreshList();
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
